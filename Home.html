<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Extractor</title>
    <!-- Use Tailwind CSS for modern, responsive styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="p-4 md:p-8 flex items-center justify-center min-h-screen bg-gray-900 text-white">

    <div class="container mx-auto p-6 bg-gray-800 rounded-lg shadow-2xl max-w-2xl w-full">
        <h1 class="text-3xl font-bold text-center text-yellow-400 mb-4">Order Data Extractor</h1>
        
        <p class="text-sm text-gray-400 mb-4 text-center">
            Paste your order data below to extract and send it to your Google Sheet.
        </p>

        <!-- Textarea for user input -->
        <textarea id="inputText" rows="10" class="w-full p-4 border-2 border-gray-700 bg-gray-700 text-white rounded-lg focus:outline-none focus:border-yellow-400 transition-colors placeholder-gray-500"></textarea>
        
        <!-- Button to trigger the extraction and sending -->
        <button onclick="processOrders()" class="w-full mt-4 py-3 bg-yellow-400 text-gray-900 font-bold rounded-lg shadow-md hover:bg-yellow-500 transition-colors">
            Extract and Send to Google Sheet
        </button>

        <!-- Div to display the extraction and upload status -->
        <div id="output" class="mt-8 p-6 bg-gray-700 rounded-lg border border-gray-600 min-h-[100px] max-h-[400px] overflow-y-auto">
            <p class="text-gray-400 text-center">Status updates will appear here...</p>
        </div>
    </div>

    <script>
        async function processOrders() {
            // IMPORTANT: Replace this placeholder with your actual Google Apps Script Web App URL
            const appsScriptUrl = 'https://script.google.com/macros/s/AKfycbxH4gorXkyfuofGu-UxXn1cK0YTJw45cDYYqNBvxKvhIf5_BcfXxFxkXZSG4XCeQowNdA/exec'; 

            const inputText = document.getElementById('inputText').value;
            const outputDiv = document.getElementById('output');

            if (appsScriptUrl === 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE') {
                outputDiv.innerHTML = '<p class="text-red-400 text-center">❌ Error: Please update the script URL in the code.</p>';
                return;
            }

            outputDiv.innerHTML = '<p class="text-gray-400 text-center animate-pulse">Extracting...</p>';

            const regex = /(\d{5,})\n[\s\S]*?(-?\d+h)?\s*(-?\d+min)/g;
            let matches;
            const extractedData = [];

            while ((matches = regex.exec(inputText)) !== null) {
                const orderId = matches[1];
                let hours = matches[2] || '';
                let minutes = matches[3] || '';

                const processedHours = processTimePart(hours);
                const processedMinutes = processTimePart(minutes);

                const deadline = (processedHours + ' ' + processedMinutes).trim();

                extractedData.push({ orderId, deadline });
            }

            if (extractedData.length > 0) {
                outputDiv.innerHTML = `<p class="text-gray-400 text-center">Extracted ${extractedData.length} orders. Sending to Google Sheet...</p>`;
                
                try {
                    const response = await fetch(appsScriptUrl, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(extractedData),
                    });

                    outputDiv.innerHTML = `<p class="text-green-400 font-semibold text-center">✅ Success! Data sent to your Google Sheet.</p>`;
                } catch (error) {
                    outputDiv.innerHTML = `<p class="text-red-400 font-semibold text-center">❌ Error: Failed to send data to Google Sheet. Check your URL and script deployment.</p>`;
                    console.error("Error sending data:", error);
                }
            } else {
                outputDiv.innerHTML = '<p class="text-gray-400 text-center">No valid orders found. Please check your input text format.</p>';
            }
        }

        function processTimePart(timePart) {
            if (!timePart) {
                return '';
            }

            const numberMatch = timePart.match(/-?(\d+)/);
            if (!numberMatch) {
                return timePart;
            }

            const number = parseInt(numberMatch[1]);
            const unit = timePart.replaceAll(numberMatch[0], '');

            if (timePart.startsWith('-')) {
                return `${number}${unit}`;
            } else {
                return `-${number}${unit}`;
            }
        }
    </script>
</body>
</html>
